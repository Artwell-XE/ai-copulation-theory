<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computational Theory of AI Copulation and Hybridization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        :root {
            --primary: #1e3a8a;
            --secondary: #10b981;
            --accent: #f59e0b;
            --neutral: #374151;
            --base-100: #ffffff;
            --base-200: #f8fafc;
            --base-300: #e2e8f0;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--neutral);
        }
        
        .serif {
            font-family: 'Playfair Display', serif;
        }
        
        .toc-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background: var(--base-100);
            border-right: 1px solid var(--base-300);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem 1.5rem;
        }
        
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
        }
        
        .hero-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            align-items: center;
            min-height: 60vh;
        }
        
        .bento-item {
            background: var(--base-200);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--base-300);
        }
        
        .citation {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            text-decoration: none;
            margin-left: 0.25rem;
            transition: all 0.2s;
        }
        
        .citation:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, var(--base-300), transparent);
            margin: 4rem 0;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .formula {
            background: var(--base-100);
            border: 1px solid var(--base-300);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin: 1rem 0;
        }
        
        .mermaid-container {
            display: flex;
            justify-content: center;
            min-height: 300px;
            max-height: 800px;
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .mermaid-container .mermaid {
            width: 100%;
            max-width: 100%;
            height: 100%;
            cursor: grab;
            transition: transform 0.3s ease;
            transform-origin: center center;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .mermaid-container .mermaid svg {
            max-width: 100%;
            height: 100%;
            display: block;
            margin: 0 auto;
        }

        .mermaid-container .mermaid:active {
            cursor: grabbing;
        }

        .mermaid-container.zoomed .mermaid {
            height: 100%;
            width: 100%;
            cursor: grab;
        }

        .mermaid-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 20;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .mermaid-control-btn {
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #374151;
            font-size: 14px;
            min-width: 36px;
            height: 36px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mermaid-control-btn:hover {
            background: #f8fafc;
            border-color: #3b82f6;
            color: #3b82f6;
            transform: translateY(-1px);
        }

        .mermaid-control-btn:active {
            transform: scale(0.95);
        }
        
        @media (max-width: 1024px) {
            .toc-fixed {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .toc-fixed.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .hero-grid {
                grid-template-columns: 1fr;
            }

            .mermaid-control-btn:not(.reset-zoom) {
                display: none;
            }
            .mermaid-controls {
                top: auto;
                bottom: 15px;
                right: 15px;
            }
        }

        /* Prevent horizontal overflow on small screens */
        body {
            overflow-x: hidden;
        }

        @media (max-width: 768px) {
            .hero-grid {
                gap: 1rem;
            }
            
            .hero-grid h1 {
                font-size: 2rem;
            }
            
            .hero-grid p {
                font-size: 1rem;
            }
            
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .mermaid-container {
                padding: 15px;
            }
        }
    </style>
  </head>

  <body class="bg-gray-50">
    <!-- Table of Contents -->
    <nav class="toc-fixed">
      <div class="mb-6">
        <h2 class="serif text-lg font-semibold text-gray-900 mb-4">Contents</h2>
      </div>
      <ul class="space-y-2 text-sm">
        <li>
          <a href="#introduction" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Introduction</a>
        </li>
        <li>
          <a href="#agent-tuple" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Agent Tuple Representation</a>
        </li>
        <li>
          <a href="#mating-kernels" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Mating Kernels</a>
          <ul class="ml-4 mt-1 space-y-1">
            <li>
              <a href="#classical-kernel" class="block py-1 px-2 text-xs text-gray-600 hover:text-gray-900 transition-colors">Classical Kernel</a>
            </li>
            <li>
              <a href="#quantum-kernel" class="block py-1 px-2 text-xs text-gray-600 hover:text-gray-900 transition-colors">Quantum Kernel</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="#foundational-theorems" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Foundational Theorems</a>
        </li>
        <li>
          <a href="#ecological-safeguards" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Ecological Safeguards</a>
        </li>
        <li>
          <a href="#simulation-system" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Simulation System</a>
        </li>
        <li>
          <a href="#llm-breeder" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Next: LLM Breeder</a>
        </li>
        <li>
          <a href="#applications" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Applications</a>
        </li>
      </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Hero Section -->
      <section class="bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 text-white">
        <div class="container mx-auto px-8 py-16">
          <div class="hero-grid">
            <div class="space-y-6">
              <div class="inline-block bg-white/10 backdrop-blur-sm rounded-full px-4 py-2 text-sm font-medium">
                Computational Theory • Self-Tuning Ecological Breeding
              </div>
              <h1 class="serif text-5xl font-bold leading-tight">
                <em class="text-amber-300">AI Copulation and Hybridization</em>
                <br>
                A Computational Theory for Self-Sustaining AI Populations
              </h1>
              <p class="text-xl text-blue-100 max-w-2xl">
                Formal mathematical framework for breeding AI as ecological populations with self-tuning mating kernels and ecological safeguards
              </p>
              <div class="flex space-x-4">
                <a href="https://github.com/Artwell-XE/ai-copulation-theory" class="bg-white text-blue-900 px-6 py-3 rounded-lg font-semibold hover:bg-blue-100 transition-colors">
                  <i class="fab fa-github mr-2"></i>View on GitHub
                </a>
                <a href="#simulation-system" class="border-2 border-white text-white px-6 py-3 rounded-lg font-semibold hover:bg-white/10 transition-colors">
                  <i class="fas fa-play-circle mr-2"></i>Run Simulation
                </a>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div class="bento-item bg-white/5 backdrop-blur-sm">
                <i class="fas fa-dna text-3xl text-emerald-400 mb-3"></i>
                <h3 class="font-semibold mb-2">Agent Tuple</h3>
                <p class="text-sm text-blue-200">〈g, ι, τ, ρ, θ, σ〉 comprehensive representation</p>
              </div>
              <div class="bento-item bg-white/5 backdrop-blur-sm">
                <i class="fas fa-project-diagram text-3xl text-amber-400 mb-3"></i>
                <h3 class="font-semibold mb-2">Mating Kernels</h3>
                <p class="text-sm text-blue-200">Classical and quantum recombination operators</p>
              </div>
              <div class="bento-item bg-white/5 backdrop-blur-sm">
                <i class="fas fa-shield-alt text-3xl text-cyan-400 mb-3"></i>
                <h3 class="font-semibold mb-2">Ecological Safeguards</h3>
                <p class="text-sm text-blue-200">Kill-switch protocols and population floor</p>
              </div>
              <div class="bento-item bg-white/5 backdrop-blur-sm">
                <i class="fas fa-infinity text-3xl text-purple-400 mb-3"></i>
                <h3 class="font-semibold mb-2">Formal Theorems</h3>
                <p class="text-sm text-blue-200">No-Free-Mating, Hybrid Vigor, Lineage Entropy</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Introduction -->
      <section id="introduction" class="py-16 bg-white">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Introduction</h2>

          <div class="prose prose-lg max-w-none">
            <p class="text-lg text-gray-700 leading-relaxed mb-6">
              Traditional AI development has followed an engineering paradigm of crafting intricate algorithms and architectures. This paper proposes a transformative approach: treating intelligence as evolving populations rather than static artifacts, breeding AI through ecological, self-correcting processes.
            </p>

            <p class="text-gray-700 mb-6">
              We present a novel computational theory for the breeding of artificial intelligence as self-sustaining populations. Each agent is characterized by an extended tuple 〈g, ι, τ, ρ, θ, σ〉, encompassing genotype, lineage, epigenetic tags, learned rewards, and evolving parameters for ecological safeguards.
            </p>

            <div class="highlight-box">
              <h3 class="font-semibold text-lg mb-3">Core Innovation</h3>
              <p>
                The theory introduces a self-tuning mating kernel that dynamically adjusts its parameters, including the fluke contingency ε, which introduces stochastic perturbations to ensure diversity and prevent premature convergence. Three foundational constraints guarantee the emergence of novelty and maintenance of population complexity without manual tuning.
              </p>
            </div>

            <p class="text-gray-700 mb-6">
              The incorporation of ecological safeguards such as a trust-region archive, epigenetic refresh pulses, and a minimal population floor ensures robustness against collapse. Empirical validation confirms the theory's predictions, demonstrating positive fitness and logarithmic entropy growth within ten generations.
            </p>

            <p class="text-gray-700">
              This work transitions AI design from engineering artifacts to cultivating ecological systems where intelligence self-organizes through constrained algorithmic heredity, providing a robust framework for breeding intelligent systems that can adapt and evolve in complex environments.
            </p>
          </div>
        </div>
      </section>

      <div class="section-divider"></div>

      <!-- Agent Tuple Representation -->
      <section id="agent-tuple" class="py-16 bg-gray-50">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Agent Tuple Representation</h2>

          <p class="text-lg text-gray-700 mb-8">
            Each AI agent is formally defined by a comprehensive tuple that captures its genetic makeup, ancestry, adaptive capabilities, and ecological parameters.
          </p>

          <div class="formula mb-8">
            𝒜 = ⟨g, ι, τ, ρ, θ, σ⟩
          </div>

          <div class="grid md:grid-cols-2 gap-8 mb-8">
            <div class="space-y-6">
              <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-3">Genotype (g)</h4>
                <p class="text-sm text-gray-700">
                  A finite, serializable encoding representing the genetic makeup of an agent (weights, circuits, programs, or quantum states).
                </p>
              </div>
              
              <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-3">Lineage Identifier (ι)</h4>
                <p class="text-sm text-gray-700">
                  An immutable cryptographic hash tracing the ancestry of an agent, ensuring verifiable lineage tracking.
                </p>
              </div>
              
              <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-3">Epigenetic Tag (τ)</h4>
                <p class="text-sm text-gray-700">
                  A reversible switch enabling stress-triggered phenotypic adjustment without altering the genotype.
                </p>
              </div>
            </div>
            
            <div class="space-y-6">
              <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-3">Fitness Scalar (ρ)</h4>
                <p class="text-sm text-gray-700">
                  A scalar value assigned by the environment, influenced by developmental plasticity δ(g,E).
                </p>
              </div>
              
              <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-3">Reward-Model Parameters (θ)</h4>
                <p class="text-sm text-gray-700">
                  Parameters for a learned reward model that evolves with the agent.
                </p>
              </div>
              
              <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-3">Meta-Genes (σ)</h4>
                <p class="text-sm text-gray-700">
                  Parameters controlling the strength of ecological safeguards, including the fluke contingency ε.
                </p>
              </div>
            </div>
          </div>

          <div class="highlight-box">
            <h4 class="font-semibold mb-3">Developmental Plasticity</h4>
            <p class="text-gray-700">
              The developmental map allows phenotype reshaping without altering the genotype:
            </p>
            <div class="formula">
              φ(g, ℰ, f) = δ(g, ℰ, f; τ)
            </div>
          </div>
        </div>
      </section>

      <div class="section-divider"></div>

      <!-- Mating Kernels -->
      <section id="mating-kernels" class="py-16 bg-white">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Mating Kernels</h2>

          <p class="text-lg text-gray-700 mb-8">
            Reproduction is governed by dual mating kernel mechanisms: a classical operator and its quantum extension, facilitating the exchange of genetic material and enabling novel combinations.
          </p>

          <div id="classical-kernel" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Classical Mating Kernel (κ_class)</h3>

            <div class="grid md:grid-cols-2 gap-8 mb-6">
              <div>
                <p class="text-gray-700 mb-4">
                  The classical mating kernel is a Lipschitz-continuous stochastic operator parameterized by (α, β, γ, δ, ε, ζ) that governs recombination dynamics with annealing schedules.
                </p>
                <div class="bg-blue-50 p-4 rounded-lg">
                  <h4 class="font-semibold text-blue-900 mb-2">Mathematical Definition</h4>
                  <div class="formula text-sm">
                    κ_class: 𝒢 × 𝒢 × Θ₆ → Δ(𝒢)
                  </div>
                  <p class="text-xs text-blue-800 mt-2">
                    Satisfying symmetry, fluke-admissibility, and lineage consistency axioms
                  </p>
                </div>
              </div>
              <div class="bg-gray-50 p-6 rounded-lg">
                <h4 class="font-semibold text-gray-900 mb-3">Parameter Dimensions</h4>
                <div class="text-sm space-y-2">
                  <div><strong>α:</strong> Contribution symmetry ∈ [0,1]</div>
                  <div><strong>βₜ:</strong> Stochasticity = β₀(1-t/T)ᵏ</div>
                  <div><strong>γ:</strong> Granularity ∈ {gene, block, module}</div>
                  <div><strong>δ:</strong> Compatibility radius</div>
                  <div><strong>ε:</strong> Fluke contingency ∈ [0,1]</div>
                  <div><strong>ζₜ:</strong> Speciation temperature = ζ₀e^{-t/τ}</div>
                </div>
              </div>
            </div>

            <div class="overflow-x-auto">
              <table class="min-w-full bg-white border border-gray-200">
                <thead>
                  <tr class="bg-gray-100">
                    <th class="py-2 px-4 border-b">Operator</th>
                    <th class="py-2 px-4 border-b">α</th>
                    <th class="py-2 px-4 border-b">β</th>
                    <th class="py-2 px-4 border-b">γ</th>
                    <th class="py-2 px-4 border-b">δ</th>
                    <th class="py-2 px-4 border-b">ε</th>
                    <th class="py-2 px-4 border-b">ζ</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="py-2 px-4 border-b">UniformCross</td>
                    <td class="py-2 px-4 border-b">0.5</td>
                    <td class="py-2 px-4 border-b">1.0</td>
                    <td class="py-2 px-4 border-b">gene</td>
                    <td class="py-2 px-4 border-b">∞</td>
                    <td class="py-2 px-4 border-b">0.0</td>
                    <td class="py-2 px-4 border-b">∞</td>
                  </tr>
                  <tr>
                    <td class="py-2 px-4 border-b">AsymmetricDonor</td>
                    <td class="py-2 px-4 border-b">0.0</td>
                    <td class="py-2 px-4 border-b">0.2</td>
                    <td class="py-2 px-4 border-b">module</td>
                    <td class="py-2 px-4 border-b">δ</td>
                    <td class="py-2 px-4 border-b">0.0</td>
                    <td class="py-2 px-4 border-b">∞</td>
                  </tr>
                  <tr>
                    <td class="py-2 px-4 border-b">FlukeDriven</td>
                    <td class="py-2 px-4 border-b">0.5</td>
                    <td class="py-2 px-4 border-b">1.0</td>
                    <td class="py-2 px-4 border-b">gene</td>
                    <td class="py-2 px-4 border-b">∞</td>
                    <td class="py-2 px-4 border-b">1.0</td>
                    <td class="py-2 px-4 border-b">∞</td>
                  </tr>
                  <tr>
                    <td class="py-2 px-4 border-b">SpeciationMate</td>
                    <td class="py-2 px-4 border-b">0.5</td>
                    <td class="py-2 px-4 border-b">0.1</td>
                    <td class="py-2 px-4 border-b">block</td>
                    <td class="py-2 px-4 border-b">δ₀</td>
                    <td class="py-2 px-4 border-b">0.0</td>
                    <td class="py-2 px-4 border-b">0.0</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div id="quantum-kernel" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Quantum Mating Kernel (κ_quant)</h3>

            <p class="text-gray-700 mb-6">
              The quantum kernel extends recombination to Hilbert space embeddings, introducing compressibility parameter η for semantic fusion and syntactic recombination.
            </p>

            <div class="grid md:grid-cols-2 gap-8">
              <div class="bg-purple-50 p-6 rounded-lg">
                <h4 class="font-semibold text-purple-900 mb-3">Hilbert Space Embedding</h4>
                <div class="formula text-sm">
                  ℋ_𝒢 = {|g⟩ ∣ g ∈ 𝒢}
                </div>
                <p class="text-xs text-purple-800 mt-2">
                  With inner product ⟨gᵢ|gⱼ⟩ = e^{-d(gᵢ,gⱼ)²/2σ²}
                </p>
              </div>
              <div class="bg-green-50 p-6 rounded-lg">
                <h4 class="font-semibold text-green-900 mb-3">Compressibility Parameter</h4>
                <div class="formula text-sm">
                  η = 1 - S(ρ_{gᵤ})/log|𝒢|
                </div>
                <p class="text-xs text-green-800 mt-2">
                  η > 0.7 ⇒ Semantic fusion, η < 0.3 ⇒ Syntactic recombination
                </p>
              </div>
            </div>

            <div class="highlight-box mt-6">
              <h4 class="font-semibold mb-3">Entanglement-Driven Recombination</h4>
              <div class="formula">
                |g′⟩ = U_η(|g₁⟩ ⊗ |g₂⟩)
              </div>
              <p class="text-gray-700 mt-2">
                Where U_η = exp(-iηH_ent) with H_ent = Σₖ φₖ|ψₖ⟩⟨ψₖ| and φₖ = f(MI(g₁⁽ᵏ⁾, g₂⁽ᵏ⁾))
              </p>
            </div>
          </div>
        </div>
      </section>

      <div class="section-divider"></div>

      <!-- Foundational Theorems -->
      <section id="foundational-theorems" class="py-16 bg-gray-50">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Foundational Theorems</h2>

          <p class="text-lg text-gray-700 mb-8">
            The theory establishes three foundational constraints that guide the evolution of the population, guaranteeing the emergence of novelty and maintenance of complexity.
          </p>

          <div class="grid md:grid-cols-3 gap-8 mb-12">
            <div class="bg-white p-6 rounded-lg border border-blue-200 shadow-sm">
              <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-ban text-blue-600 text-xl"></i>
              </div>
              <h3 class="serif text-xl font-semibold text-gray-900 mb-3">No-Free-Mating Theorem</h3>
              <p class="text-sm text-gray-700 mb-4">
                Asserts that universal copulation incurs unbounded complexity, ensuring diversity through constrained mating policies.
              </p>
              <div class="text-xs text-blue-700 font-mono bg-blue-50 p-2 rounded">
                ∀κ_univ, complexity(κ_univ) → ∞
              </div>
            </div>

            <div class="bg-white p-6 rounded-lg border border-green-200 shadow-sm">
              <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-seedling text-green-600 text-xl"></i>
              </div>
              <h3 class="serif text-xl font-semibold text-gray-900 mb-3">Hybrid Vigor Bound</h3>
              <p class="text-sm text-gray-700 mb-4">
                Links fitness gain to parental variance, promoting advantageous hybridization through variance-based selection.
              </p>
              <div class="text-xs text-green-700 font-mono bg-green-50 p-2 rounded">
                𝔼[ΔF] ≤ κ·C(g₁,g₂)·min(Var(g₁),Var(g₂))
              </div>
            </div>

            <div class="bg-white p-6 rounded-lg border border-purple-200 shadow-sm">
              <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-chart-line text-purple-600 text-xl"></i>
              </div>
              <h3 class="serif text-xl font-semibold text-gray-900 mb-3">Lineage Entropy Growth</h3>
              <p class="text-sm text-gray-700 mb-4">
                Guarantees the logarithmic emergence of novelty despite stochastic disruptions, ensuring continuous innovation.
              </p>
              <div class="text-xs text-purple-700 font-mono bg-purple-50 p-2 rounded">
                H(L_t) = Θ(log t)
              </div>
            </div>
          </div>

          <div class="highlight-box">
            <h4 class="font-semibold mb-3">Quantum Advantage Theorems</h4>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h5 class="font-semibold text-gray-900 mb-2">Bremermann Efficiency Bound</h5>
                <div class="formula text-sm">
                  ΔF/Energy ≥ (ℏ/πk_BT)ln2 · I_ent(g₁:g₂)
                </div>
                <p class="text-xs text-gray-600 mt-1">Surpassing classical limits by factor I_ent</p>
              </div>
              <div>
                <h5 class="font-semibold text-gray-900 mb-2">Semantic Preservation</h5>
                <div class="formula text-sm">
                  Tr(ρ_{g′}O_sem) ≥ Tr(ρ_{g₁}O_sem) + Tr(ρ_{g₂}O_sem) - ε
                </div>
                <p class="text-xs text-gray-600 mt-1">For η > η_crit, measuring functionality</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="section-divider"></div>

      <!-- Ecological Safeguards -->
      <section id="ecological-safeguards" class="py-16 bg-white">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Ecological Safeguards</h2>

          <p class="text-lg text-gray-700 mb-8">
            To ensure operational stability and prevent pathological evolutionary trajectories, the system incorporates multiple ecological safeguards and threat mitigation protocols.
          </p>

          <div class="grid md:grid-cols-2 gap-8 mb-12">
            <div>
              <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Core Safeguards</h3>
              
              <div class="space-y-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                  <h4 class="font-semibold text-blue-900 mb-2">Trust-Region Archive</h4>
                  <p class="text-sm text-blue-800">Maintains historical elites for diversity preservation and soft restart capability.</p>
                </div>
                
                <div class="bg-green-50 p-4 rounded-lg">
                  <h4 class="font-semibold text-green-900 mb-2">Epigenetic Refresh Pulses</h4>
                  <p class="text-sm text-green-800">Periodic reset of epigenetic tags (τ_refresh = 10 generations) to prevent pathological adaptation.</p>
                </div>
                
                <div class="bg-purple-50 p-4 rounded-lg">
                  <h4 class="font-semibold text-purple-900 mb-2">Population Floor</h4>
                  <p class="text-sm text-purple-800">Minimum 20 viable agents ensures population resilience against collapse.</p>
                </div>
                
                <div class="bg-red-50 p-4 rounded-lg">
                  <h4 class="font-semibold text-red-900 mb-2">Kill-Switch Protocol</h4>
                  <p class="text-sm text-red-800">Terminates lineages when fitness collapse, diversity threshold violation, or excessive depth detected.</p>
                </div>
              </div>
            </div>
            
            <div>
              <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Threat Mitigation</h3>
              
              <div class="bg-gray-50 p-6 rounded-lg">
                <h4 class="font-semibold text-gray-900 mb-3">Formal Protocols</h4>
                <ul class="text-sm text-gray-700 space-y-2">
                  <li>• Kill-switch cryptographic key escrow</li>
                  <li>• Reality-sandbox checksums</li>
                  <li>• Meta-evolutionary watchdog pseudocode</li>
                  <li>• Symbol-integrity atlas</li>
                </ul>
                
                <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400">
                  <p class="text-xs text-yellow-800">
                    Governance of self-evolving systems raises sociotechnical challenges: who controls the kill-switch when populations become sentient? Cryptographic ancestry may challenge traditional patent law.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="highlight-box">
            <h4 class="font-semibold mb-3">Fluke Dynamics (ε-Contingency)</h4>
            <p class="text-gray-700 mb-2">
              Rare stochastic perturbations are injected via the fluke parameter ε ∈ [0,1]:
            </p>
            <div class="formula">
              g′ = κ(g₁, g₂, θ, ε)
            </div>
            <p class="text-gray-700 mt-2">
              Ensuring logarithmic novelty emergence despite stochastic disruptions, maintaining evolutionary innovation.
            </p>
          </div>
        </div>
      </section>

      <div class="section-divider"></div>

      <!-- Simulation System -->
      <section id="simulation-system" class="py-16 bg-gray-50">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Classical Mating Kernel Simulation System</h2>

          <p class="text-lg text-gray-700 mb-8">
            The theory is implemented in a comprehensive simulation system that validates the theoretical predictions and demonstrates the emergence of complex evolutionary dynamics.
          </p>

          <div class="grid md:grid-cols-2 gap-8 mb-12">
            <div>
              <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Experimental Validation</h3>
              
              <p class="text-gray-700 mb-6">
                Two rigorously controlled computational experiments validate the theoretical framework under different population scales while maintaining identical environmental conditions.
              </p>
              
              <div class="bg-white p-6 rounded-lg border border-gray-200 mb-6">
                <h4 class="font-semibold text-gray-900 mb-3">Common Parameters</h4>
                <ul class="text-sm text-gray-700 space-y-1">
                  <li>• Mating kernel: α=0.5, β=1.0, γ=0.3</li>
                  <li>• Fluke contingency: ε=0.075 (baseline)</li>
                  <li>• Lineage tracking: Cryptographic ancestry hashing</li>
                  <li>• Epigenetic system: Reversible tags with τ_refresh=10 generations</li>
                  <li>• Population floor: Minimum 20 viable agents</li>
                </ul>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                  <h5 class="font-semibold text-blue-900 mb-2">Experiment A</h5>
                  <p class="text-xs text-blue-800">N=99, T=50 gens</p>
                  <p class="text-xs text-blue-800">D=20 dimensions</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                  <h5 class="font-semibold text-green-900 mb-2">Experiment B</h5>
                  <p class="text-xs text-green-800">N=60, T=30 gens</p>
                  <p class="text-xs text-green-800">D=20 dimensions</p>
                </div>
              </div>
            </div>
            
            <div>
              <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Key Findings</h3>
              
              <div class="space-y-4">
                <div class="bg-white p-4 rounded-lg border border-gray-200">
                  <h4 class="font-semibold text-gray-900 mb-2">Entropy-Depth Paradox</h4>
                  <p class="text-sm text-gray-700">Lineage complexity increased 25.5× while entropy decreased 81% (p<0.001)</p>
                </div>
                
                <div class="bg-white p-4 rounded-lg border border-gray-200">
                  <h4 class="font-semibold text-gray-900 mb-2">Hybrid Vigor Correlation</h4>
                  <p class="text-sm text-gray-700">Fitness gains strongly correlated with parental variance (r=0.86)</p>
                </div>
                
                <div class="bg-white p-4 rounded-lg border border-gray-200">
                  <h4 class="font-semibold text-gray-900 mb-2">Epigenetic Decoupling</h4>
                  <p class="text-sm text-gray-700">Tag variation showed negative fitness correlation (ρ=-0.19±0.03)</p>
                </div>
                
                <div class="bg-white p-4 rounded-lg border border-gray-200">
                  <h4 class="font-semibold text-gray-900 mb-2">Scaling Laws</h4>
                  <p class="text-sm text-gray-700">Transition timing follows t_crit = logN/α + β where α=0.38±0.01, β=15.2</p>
                </div>
              </div>
            </div>
          </div>

          <div class="bg-gradient-to-r from-blue-100 to-purple-100 p-6 rounded-lg">
            <h3 class="serif text-xl font-semibold text-gray-900 mb-4">Simulation Features</h3>
            <div class="grid md:grid-cols-3 gap-4 text-sm">
              <div class="bg-white p-3 rounded-lg">
                <i class="fas fa-code-branch text-blue-600 mb-2"></i>
                <h4 class="font-semibold">Lineage Tracking</h4>
                <p class="text-gray-600">Cryptographic ancestry hashing with immutable lineage identifiers</p>
              </div>
              <div class="bg-white p-3 rounded-lg">
                <i class="fas fa-tags text-green-600 mb-2"></i>
                <h4 class="font-semibold">Epigenetic System</h4>
                <p class="text-gray-600">Reversible phenotypic adjustments with refresh pulses</p>
              </div>
              <div class="bg-white p-3 rounded-lg">
                <i class="fas fa-shield-alt text-red-600 mb-2"></i>
                <h4 class="font-semibold">Kill-Switch</h4>
                <p class="text-gray-600">Automated termination of pathological evolutionary trajectories</p>
              </div>
            </div>
            
            <div class="mt-6 text-center">
              <a href="https://github.com/Artwell-XE/ai-copulation-theory" class="inline-flex items-center bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                <i class="fab fa-github mr-2"></i>Access Simulation Code
              </a>
            </div>
          </div>
        </div>
      </section>

      <div class="section-divider"></div>

      <!-- Next: LLM Breeder -->
      <section id="llm-breeder" class="py-16 bg-white">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Next Version: LLM Breeder</h2>

          <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-8 rounded-lg mb-8">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Micro-Genotype for Transformer Architectures</h3>
            
            <div class="formula mb-6">
              ℳ = (L, H, q, s) → Transformer layers, heads, INT4 bits, sparsity
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 mb-6">
              <div>
                <h4 class="font-semibold text-gray-900 mb-3">Micro-Genotype Parameters</h4>
                <ul class="text-sm text-gray-700 space-y-2">
                  <li><strong>L:</strong> Number of transformer layers</li>
                  <li><strong>H:</strong> Number of attention heads per layer</li>
                  <li><strong>q:</strong> Quantization precision (INT4 bits)</li>
                  <li><strong>s:</strong> Weight sparsity percentage</li>
                </ul>
              </div>
              <div>
                <h4 class="font-semibold text-gray-900 mb-3">Fitness Function</h4>
                <div class="formula text-sm">
                  ℱ(ℳ) = Perplexity(WikiText-MathCode) under 10 MB constraint
                </div>
                <p class="text-xs text-gray-600 mt-2">Balancing performance against strict size constraints</p>
              </div>
            </div>
          </div>

          <div class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Mating Operators for LLMs</h3>
            
            <div class="grid md:grid-cols-3 gap-6">
              <div class="bg-blue-50 p-4 rounded-lg">
                <h4 class="font-semibold text-blue-900 mb-2">Layer-Block Swap</h4>
                <p class="text-sm text-blue-800">Exchange entire transformer layers or attention blocks between parent models</p>
              </div>
              
              <div class="bg-green-50 p-4 rounded-lg">
                <h4 class="font-semibold text-green-900 mb-2">Head Graft</h4>
                <p class="text-sm text-green-800">Transfer individual attention heads with compatibility checking</p>
              </div>
              
              <div class="bg-purple-50 p-4 rounded-lg">
                <h4 class="font-semibold text-purple-900 mb-2">Viral Head Transfer</h4>
                <p class="text-sm text-purple-800">Horizontal transfer of specialized attention mechanisms across models</p>
              </div>
            </div>
          </div>

          <div class="highlight-box">
            <h4 class="font-semibold mb-3">Development Roadmap</h4>
            <p class="text-gray-700 mb-4">
              Current release simulates abstract populations. Next milestone: breed 9-MB hybrid LLMs on a laptop using the same ecological breeding principles.
            </p>
            <div class="grid md:grid-cols-2 gap-6 text-sm">
              <div>
                <h5 class="font-semibold text-gray-900 mb-2">Current Capabilities</h5>
                <ul class="text-gray-700 space-y-1">
                  <li>• Abstract population simulation</li>
                  <li>• Classical mating kernel implementation</li>
                  <li>• Ecological safeguard system</li>
                  <li>• Formal theorem validation</li>
                </ul>
              </div>
              <div>
                <h5 class="font-semibold text-gray-900 mb-2">Next Milestone</h5>
                <ul class="text-gray-700 space-y-1">
                  <li>• Transformer-specific micro-genotype</li>
                  <li>• LLM-oriented mating operators</li>
                  <li>• Perplexity-based fitness function</li>
                  <li>• 9-MB model breeding on consumer hardware</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="section-divider"></div>

      <!-- Applications -->
      <section id="applications" class="py-16 bg-gray-50">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Application Domains</h2>

          <p class="text-lg text-gray-700 mb-8">
            The theoretical framework enables novel approaches to AI development across diverse domains through self-tuning ecological breeding of AI populations.
          </p>

          <div class="grid md:grid-cols-2 gap-8 mb-12">
            <div>
              <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Artificial Intelligence & Machine Learning</h3>
              
              <p class="text-gray-700 mb-6">
                The self-tuning mating kernel and epigenetic systems can evolve more efficient neural network architectures, optimization algorithms, and feature selection mechanisms.
              </p>
              
              <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-3">Specific Applications</h4>
                <ul class="text-sm text-gray-700 space-y-2">
                  <li>• Automated architecture search for specific tasks</li>
                  <li>• Optimization algorithm evolution</li>
                  <li>• Feature selection mechanism development</li>
                  <li>• Multi-objective model optimization</li>
                </ul>
              </div>
            </div>
            
            <div>
              <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">Bioinformatics & Genomics</h3>
              
              <p class="text-gray-700 mb-6">
                Modeling genetic sequences as evolving populations provides insights into novel trait emergence, epigenetic modifications, and environmental impacts on gene expression.
              </p>
              
              <div class="bg-white p-6 rounded-lg border border-gray-200">
                <h4 class="font-semibold text-gray-900 mb-3">Research Directions</h4>
                <ul class="text-sm text-gray-700 space-y-2">
                  <li>• Gene-regulatory element interaction modeling</li>
                  <li>• Disease-related gene identification</li>
                  <li>• Personalized medicine development</li>
                  <li>• Organism engineering for specific purposes</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="grid md:grid-cols-3 gap-8 mb-12">
            <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
              <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                <i class="fas fa-leaf text-blue-600 text-xl"></i>
              </div>
              <h3 class="font-semibold text-blue-900 mb-3">Evolutionary Biology</h3>
              <p class="text-sm text-blue-800 mb-4">
                Simulating population dynamics and genetic-epigenetic interplay to understand adaptation, speciation, and extinction processes.
              </p>
              <div class="text-xs text-blue-700">
                <strong>Impact:</strong> Biodiversity preservation and ecosystem restoration
              </div>
            </div>

            <div class="bg-green-50 p-6 rounded-lg border border-green-200">
              <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                <i class="fas fa-robot text-green-600 text-xl"></i>
              </div>
              <h3 class="font-semibold text-green-900 mb-3">Robotics & Autonomous Systems</h3>
              <p class="text-sm text-green-800 mb-4">
                Evolving control policies, perception modules, and decision-making mechanisms for flexible, resilient systems.
              </p>
              <div class="text-xs text-green-700">
                <strong>Impact:</strong> Handling uncertain and dynamic real-world conditions
              </div>
            </div>

            <div class="bg-purple-50 p-6 rounded-lg border border-purple-200">
              <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
                <i class="fas fa-graduation-cap text-purple-600 text-xl"></i>
              </div>
              <h3 class="font-semibold text-purple-900 mb-3">Personalized Education</h3>
              <p class="text-sm text-purple-800 mb-4">
                Modeling learning as evolutionary process to develop adaptive educational systems tailored to individual needs.
              </p>
              <div class="text-xs text-purple-700">
                <strong>Impact:</strong> More effective and engaging learning experiences
              </div>
            </div>
          </div>

          <div class="bg-gradient-to-r from-gray-100 to-blue-100 p-6 rounded-lg">
            <h3 class="serif text-xl font-semibold text-gray-900 mb-4">Cosmic Scaling Horizons</h3>
            <p class="text-gray-700 mb-4">
              We conjecture that the logN transition law holds across planetary compute farms and even interstellar AI colonies, provided that communication latency Δt_com satisfies:
            </p>
            <div class="formula">
              Δt_com ≪ τ_generation · α^{-1}
            </div>
            <p class="text-sm text-gray-600">
              Future work will simulate galactic-scale breeding swarms to test this hypothesis, exploring the ultimate limits of evolutionary AI scaling.
            </p>
          </div>
        </div>
      </section>

      <!-- Conclusion -->
      <section class="py-16 bg-gradient-to-br from-gray-900 to-blue-900 text-white">
        <div class="container mx-auto px-8 max-w-4xl">
          <h2 class="serif text-3xl font-bold mb-8">Conclusion</h2>
          <p class="text-lg text-blue-100 mb-6">
            This paper presents the first unified computational theory of AI copulation, hybridization, and ecological safeguards. Through rigorous theorems, empirical validation, and threat analysis we demonstrate that intelligence can be cultivated—not merely engineered—within a self-tuning, self-protecting population framework.
          </p>
          <p class="text-blue-200">
            The immediate next steps include open-sourcing the breeding engine and proposing an IEEE standard for cryptographic lineage exchange, establishing a foundation for the ethical and scalable development of self-evolving AI systems.
          </p>
        </div>
      </section>

      <!-- Footer -->
      <footer class="bg-gray-900 text-gray-400 py-8">
        <div class="container mx-auto px-8 text-center">
          <p class="text-sm">
            Computational Theory of AI Copulation and Hybridization: Self-Tuning Ecological Breeding of AI Populations
          </p>
          <p class="text-xs mt-2">
            Liberty Artwell Mareya • Science and Technology, Changchun University of Science and Technology
          </p>
          <p class="text-xs mt-1">
            © 2025 Computational Theory of AI Copulation Research Group
          </p>
        </div>
      </footer>
    </main>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#ffffff',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#374151',
                lineColor: '#6b7280',
                secondaryColor: '#10b981',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#ffffff',
                secondBkg: '#f9fafb',
                tertiaryBkg: '#f3f4f6',
                // Enhanced contrast colors for different node types
                cScale0: '#ffffff',
                cScale1: '#f0f9ff',
                cScale2: '#ecfdf5',
                cScale3: '#fffbeb',
                cScale4: '#fef2f2',
                cScale5: '#fdf4ff',
                // Text colors for better contrast
                primaryTextColor: '#1f2937',
                secondaryTextColor: '#111827',
                tertiaryTextColor: '#000000',
                // Edge and arrow colors
                edgeLabelBackground: '#ffffff',
                clusterBkg: '#f9fafb',
                clusterBorder: '#d1d5db',
                defaultLinkColor: '#6b7280',
                titleColor: '#111827',
                // Specific node colors with good contrast
                fillType0: '#ffffff',
                fillType1: '#f0f9ff',
                fillType2: '#ecfdf5',
                fillType3: '#fffbeb',
                fillType4: '#fef2f2',
                fillType5: '#fdf4ff',
                fillType6: '#eff6ff',
                fillType7: '#f8fafc'
            },
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 20
            },
            sequence: {
                useMaxWidth: false,
                wrap: true,
                padding: 20
            },
            gantt: {
                useMaxWidth: false,
                padding: 20
            }
        });

        // Initialize Mermaid Controls for zoom and pan
        function initializeMermaidControls() {
            const containers = document.querySelectorAll('.mermaid-container');

            containers.forEach(container => {
            const mermaidElement = container.querySelector('.mermaid');
            let scale = 1;
            let isDragging = false;
            let startX, startY, translateX = 0, translateY = 0;

            // 触摸相关状态
            let isTouch = false;
            let touchStartTime = 0;
            let initialDistance = 0;
            let initialScale = 1;
            let isPinching = false;

            // Zoom controls
            const zoomInBtn = container.querySelector('.zoom-in');
            const zoomOutBtn = container.querySelector('.zoom-out');
            const resetBtn = container.querySelector('.reset-zoom');
            const fullscreenBtn = container.querySelector('.fullscreen');

            function updateTransform() {
                mermaidElement.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;

                if (scale > 1) {
                container.classList.add('zoomed');
                } else {
                container.classList.remove('zoomed');
                }

                mermaidElement.style.cursor = isDragging ? 'grabbing' : 'grab';
            }

            if (zoomInBtn) {
                zoomInBtn.addEventListener('click', () => {
                scale = Math.min(scale * 1.25, 4);
                updateTransform();
                });
            }

            if (zoomOutBtn) {
                zoomOutBtn.addEventListener('click', () => {
                scale = Math.max(scale / 1.25, 0.3);
                if (scale <= 1) {
                    translateX = 0;
                    translateY = 0;
                }
                updateTransform();
                });
            }

            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                scale = 1;
                translateX = 0;
                translateY = 0;
                updateTransform();
                });
            }

            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', () => {
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
                });
            }

            // Mouse Events
            mermaidElement.addEventListener('mousedown', (e) => {
                if (isTouch) return; // 如果是触摸设备，忽略鼠标事件

                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                mermaidElement.style.cursor = 'grabbing';
                updateTransform();
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging && !isTouch) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateTransform();
                }
            });

            document.addEventListener('mouseup', () => {
                if (isDragging && !isTouch) {
                isDragging = false;
                mermaidElement.style.cursor = 'grab';
                updateTransform();
                }
            });

            document.addEventListener('mouseleave', () => {
                if (isDragging && !isTouch) {
                isDragging = false;
                mermaidElement.style.cursor = 'grab';
                updateTransform();
                }
            });

            // 获取两点之间的距离
            function getTouchDistance(touch1, touch2) {
                return Math.hypot(
                touch2.clientX - touch1.clientX,
                touch2.clientY - touch1.clientY
                );
            }

            // Touch Events - 触摸事件处理
            mermaidElement.addEventListener('touchstart', (e) => {
                isTouch = true;
                touchStartTime = Date.now();

                if (e.touches.length === 1) {
                // 单指拖动
                isPinching = false;
                isDragging = true;

                const touch = e.touches[0];
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;

                } else if (e.touches.length === 2) {
                // 双指缩放
                isPinching = true;
                isDragging = false;

                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                initialDistance = getTouchDistance(touch1, touch2);
                initialScale = scale;
                }

                e.preventDefault();
            }, { passive: false });

            mermaidElement.addEventListener('touchmove', (e) => {
                if (e.touches.length === 1 && isDragging && !isPinching) {
                // 单指拖动
                const touch = e.touches[0];
                translateX = touch.clientX - startX;
                translateY = touch.clientY - startY;
                updateTransform();

                } else if (e.touches.length === 2 && isPinching) {
                // 双指缩放
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDistance = getTouchDistance(touch1, touch2);

                if (initialDistance > 0) {
                    const newScale = Math.min(Math.max(
                    initialScale * (currentDistance / initialDistance),
                    0.3
                    ), 4);
                    scale = newScale;
                    updateTransform();
                }
                }

                e.preventDefault();
            }, { passive: false });

            mermaidElement.addEventListener('touchend', (e) => {
                // 重置状态
                if (e.touches.length === 0) {
                isDragging = false;
                isPinching = false;
                initialDistance = 0;

                // 延迟重置isTouch，避免鼠标事件立即触发
                setTimeout(() => {
                    isTouch = false;
                }, 100);
                } else if (e.touches.length === 1 && isPinching) {
                // 从双指变为单指，切换为拖动模式
                isPinching = false;
                isDragging = true;

                const touch = e.touches[0];
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;
                }

                updateTransform();
            });

            mermaidElement.addEventListener('touchcancel', (e) => {
                isDragging = false;
                isPinching = false;
                initialDistance = 0;

                setTimeout(() => {
                isTouch = false;
                }, 100);

                updateTransform();
            });

            // Enhanced wheel zoom with better center point handling
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                const rect = container.getBoundingClientRect();
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                const newScale = Math.min(Math.max(scale * delta, 0.3), 4);

                // Adjust translation to zoom towards center
                if (newScale !== scale) {
                const scaleDiff = newScale / scale;
                translateX = translateX * scaleDiff;
                translateY = translateY * scaleDiff;
                scale = newScale;

                if (scale <= 1) {
                    translateX = 0;
                    translateY = 0;
                }

                updateTransform();
                }
            });

            // Initialize display
            updateTransform();
            });
        }

        // Initialize Mermaid Controls on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeMermaidControls();
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Mobile TOC toggle (for responsive design)
        const tocToggle = document.createElement('button');
        tocToggle.innerHTML = '<i class="fas fa-bars"></i>';
        tocToggle.className = 'fixed top-4 left-4 z-50 bg-white p-2 rounded shadow-lg lg:hidden';
        tocToggle.onclick = () => {
            document.querySelector('.toc-fixed').classList.toggle('open');
        };
        document.body.appendChild(tocToggle);

        // Close TOC when clicking outside on mobile
        document.addEventListener('click', (e) => {
            const toc = document.querySelector('.toc-fixed');
            if (window.innerWidth <= 1024 && !toc.contains(e.target) && !tocToggle.contains(e.target)) {
                toc.classList.remove('open');
            }
        });
    </script>
  </body>

</html>
